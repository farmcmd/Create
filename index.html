<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>永續旅遊積分網站</title>
    <!-- 引入外部樣式庫 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入您的自訂 CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- 引入您的自訂 JS (模組化) -->
    <script type="module" src="script.js"></script>

    <!-- Google Maps API -->
    <!-- 新增 onerror 處理，確保在網路阻擋時也能執行 fallback -->
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwNfK9p-tYV9iR7OGjr0um8ZvJ9Hr49cM&libraries=geometry,routes&callback=initMap"
        onerror="window.mapScriptLoadError()">
    </script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

    <header class="bg-green-700 text-white p-6 text-center shadow-md relative">
        <h1 class="text-3xl font-bold">永續旅遊積分網站</h1>
        <p class="mt-2 text-lg">用低碳永續的方式探索美麗的南投農庄</p>
        
        <!-- 右側功能按鈕 -->
        <div class="mt-4 md:mt-0 md:absolute md:top-1/2 md:right-6 md:-translate-y-1/2 flex gap-3 justify-center">
            <button id="enterprise-version-btn" class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-bold rounded shadow transition duration-300">
                <i class="fas fa-building mr-1"></i> 企業版
            </button>
            <button id="gov-version-btn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold rounded shadow transition duration-300">
                <i class="fas fa-landmark mr-1"></i> 永續政府
            </button>
        </div>
    </header>

    <main class="container mx-auto p-6 mt-8">

        <section id="homepage" class="page-section block bg-white p-6 rounded-lg shadow-lg">

            <div class="bg-green-50 p-4 rounded-lg shadow-inner mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-green-700 text-center">您的個人旅遊數據</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="p-4 bg-white rounded-md shadow-sm border border-green-200">
                        <label for="player-name" class="block text-sm font-medium text-gray-700 mb-1">永續旅者姓名:</label>
                        <input type="text" id="player-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring focus:ring-green-200 focus:ring-opacity-50 text-center text-base p-2" placeholder="請輸入您的姓名">
                    </div>
                    <div class="p-4 bg-white rounded-md shadow-sm border border-green-200 text-center flex flex-col justify-center">
                        <p class="text-sm font-medium text-gray-700">永續旅者或集團企業員工隨機碼:</p>
                        <p id="player-code" class="mt-1 text-2xl font-bold text-green-600">生成中...</p>
                    </div>
                </div>
                <p id="stats-load-status" class="text-sm text-gray-600 mb-4 text-center">已自動載入之前的旅遊數據...</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-white rounded-md shadow-sm border border-green-200">
                        <p class="text-sm font-medium text-gray-700">個人累計里程</p>
                        <p id="total-mileage" class="text-2xl font-bold text-green-600">0 km</p>
                    </div>
                    <div class="p-4 bg-white rounded-md shadow-sm border border-green-200">
                        <p class="text-sm font-medium text-gray-700">個人減碳總量</p>
                        <p id="total-carbon-reduction" class="text-2xl font-bold text-green-600">0 g</p>
                    </div>
                    <div class="p-4 bg-white rounded-md shadow-sm border border-green-200">
                        <p class="text-sm font-medium text-gray-700">永續分數</p>
                        <p id="total-score" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                </div>
            </div>

            <!-- 綠色消費評鑑數據區塊 -->
            <div class="bg-emerald-50 p-6 rounded-lg shadow-inner mb-6 border border-emerald-200">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                     <h3 class="text-2xl font-semibold text-emerald-800 text-center md:text-left"><i class="fas fa-leaf mr-2"></i>綠色消費評鑑數據</h3>
                     <button id="open-green-eval-btn" class="mt-3 md:mt-0 px-6 py-2 bg-emerald-600 text-white font-bold rounded-full shadow hover:bg-emerald-700 transition duration-300 animate-pulse">
                        <i class="fas fa-calculator mr-2"></i>開啟評鑑計算
                     </button>
                </div>
               
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                    <div class="p-3 bg-white rounded-md shadow-sm border border-emerald-100">
                        <p class="text-xs font-medium text-gray-600">個人-綠色採購總額</p>
                        <p id="display-green-procurement" class="text-xl font-bold text-emerald-600">$0</p>
                    </div>
                    <div class="p-3 bg-white rounded-md shadow-sm border border-emerald-100">
                        <p class="text-xs font-medium text-gray-600">個人-SROI 社會投資報酬</p>
                        <p id="display-sroi-procurement" class="text-xl font-bold text-emerald-600">$0</p>
                    </div>
                    <div class="p-3 bg-white rounded-md shadow-sm border border-emerald-100">
                        <p class="text-xs font-medium text-gray-600">個人-專案採購總額</p>
                        <p id="display-project-procurement" class="text-xl font-bold text-emerald-600">$0</p>
                    </div>
                    <!-- 全網累積數據顯示區 -->
                    <div class="p-3 bg-emerald-100 rounded-md shadow-sm border border-emerald-300 relative overflow-hidden">
                        <p class="text-xs font-bold text-emerald-800">全網累計綠色消費總額</p>
                        <p id="display-grand-total-green" class="text-2xl font-bold text-emerald-800 my-1">連線中...</p>
                        <p class="text-[10px] text-emerald-700">累積響應次數: <span id="global-green-trans-count">0</span> 次</p>
                        <div class="absolute top-0 right-0 p-1">
                            <i class="fas fa-globe-asia text-emerald-200 text-3xl opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 全網累積減碳區塊 -->
            <div class="bg-blue-50 p-4 rounded-lg shadow-inner mb-6 relative overflow-hidden">
                 <h3 class="text-2xl font-semibold mb-4 text-blue-700 text-center">
                     累計減碳量總量 (全民減碳版)
                     <span class="block text-sm font-normal mt-1">註:自發布日2025年3月21日起累計</span>
                 </h3>
                 <div class="text-center relative z-10">
                     <p id="network-total-carbon-reduction" class="mt-1 text-3xl font-bold text-blue-600">連線中...</p>
                     <div id="trees-planted-display" class="mt-3 text-green-700">
                         <span class="text-4xl">🌳</span>
                         <p class="text-xl font-bold">已累積 <span id="trees-planted-count">0</span> 棵樹</p>
                         <p class="text-xs text-gray-600 mt-1">(每減碳10公斤，我們將實際種植一棵樹)</p>
                     </div>
                     <p id="network-stats-status" class="text-xs text-gray-600 mt-2">正在同步雲端數據...</p>
                 </div>
                 <div class="absolute top-2 right-4 opacity-10">
                     <i class="fas fa-cloud text-9xl text-blue-300"></i>
                 </div>
            </div>

            <h2 class="text-2xl font-semibold mb-6 text-green-800 text-center">選擇低碳交通方式開始您的永續旅遊</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
                <!-- 交通按鈕 -->
                <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="bike" data-carbon-reduction="350">
                    <span class="text-3xl mb-3">🚲</span>
                    <span class="font-semibold text-center text-sm">腳踏車</span>
                    <span class="text-xs text-gray-600 mt-2 text-center">減碳: 350g/10km</span>
                </button>
                <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="walk" data-carbon-reduction="400">
                    <span class="text-3xl mb-3">🚶‍♂️</span>
                    <span class="font-semibold text-center text-sm">步行</span>
                    <span class="text-xs text-gray-600 mt-2 text-center">減碳: 400g/10km</span>
                </button>
                <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="bus_train" data-carbon-reduction="300">
                    <span class="text-3xl mb-3">🚌</span>
                    <span class="font-semibold text-center text-sm">共乘巴士</span>
                    <span class="text-xs text-gray-600 mt-2 text-center">減碳: 300g/人/10km</span>
                </button>
                <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="carpool_2_moto" data-carbon-reduction="100">
                    <span class="text-3xl mb-3">🏍️🚗</span>
                    <span class="font-semibold text-center text-sm">共乘2人/摩托</span>
                    <span class="text-xs text-gray-600 mt-2 text-center">減碳: 100g/人/10km</span>
                </button>
                <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="carpool_3" data-carbon-reduction="120">
                    <span class="text-3xl mb-3">🚗</span>
                    <span class="font-semibold text-center text-sm">共乘 3 人</span>
                    <span class="text-xs text-gray-600 mt-2 text-center">減碳: 120g/人/10km</span>
                </button>
                <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="carpool_4" data-carbon-reduction="150">
                    <span class="text-3xl mb-3">🚗</span>
                    <span class="font-semibold text-center text-sm">共乘 4 人</span>
                    <span class="text-xs text-gray-600 mt-2 text-center">減碳: 150g/人/10km</span>
                </button>
                 <button class="transport-option flex flex-col items-center p-5 bg-green-100 rounded-lg shadow hover:bg-green-200 transition-all duration-300 ease-in-out" data-transport="carpool_5" data-carbon-reduction="200">
                     <span class="text-3xl mb-3">🚗</span>
                     <span class="font-semibold text-center text-sm">共乘 5 人</span>
                     <span class="text-xs text-gray-600 mt-2 text-center">減碳: 200g/人/10km</span>
                 </button>
                 <button class="transport-option flex flex-col items-center p-5 bg-blue-100 rounded-lg shadow hover:bg-blue-200 transition-all duration-300 ease-in-out" data-transport="thsr_haoxing" data-carbon-reduction="0">
                     <span class="text-3xl mb-3">🚄🚌</span>
                     <span class="font-semibold text-center text-sm">高鐵x台灣好行</span>
                     <span class="text-xs text-gray-600 mt-2 text-center">詳見專案說明</span>
                 </button>
                 <button class="transport-option flex flex-col items-center p-5 bg-yellow-100 rounded-lg shadow hover:bg-yellow-200 transition-all duration-300 ease-in-out" id="taxi-info-button">
                     <span class="text-3xl mb-3">🚕</span>
                     <span class="font-semibold text-center text-sm">預約計程車導覽</span>
                      <span class="text-xs text-gray-500 mt-1 text-center">點擊查看資訊</span>
                 </button>
            </div>

            <div id="thsr-info" class="hidden"></div>
            
            <div class="bg-orange-50 p-6 rounded-lg shadow-inner mb-8">
                <h3 class="text-2xl font-semibold mb-5 text-orange-700 text-center">景點資訊與好康報報</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                    <button id="market-mileage-button" class="flex flex-col items-center p-5 bg-purple-100 rounded-lg shadow hover:bg-purple-200 transition-all duration-300 ease-in-out">
                        <span class="text-3xl mb-3">🛍️</span>
                        <span class="font-semibold text-center text-sm">逛市集增里程</span>
                        <span class="text-xs text-gray-600 mt-2 text-center">記錄您的市集消費</span>
                    </button>
                    <button id="photo-album-promo-button" class="flex flex-col items-center p-5 bg-teal-100 rounded-lg shadow hover:bg-teal-200 transition-all duration-300 ease-in-out cursor-pointer">
                        <span class="text-3xl mb-3">📸</span>
                        <span class="font-semibold text-center text-sm">景點相簿推播</span>
                        <span class="text-xs text-gray-600 mt-2 text-center">查看最新活動照片</span>
                    </button>
                </div>
            </div>

             <div class="bg-gray-100 p-6 rounded-lg shadow-inner mb-8">
                 <h3 class="text-2xl font-semibold mb-5 text-gray-700 text-center">更多活動與資訊</h3>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                     <a href="https://drive.google.com/drive/folders/1en2b6PB8A-uxDubopiyW99uUKbUjlqcp?usp=sharing" id="latest-activity-link" target="_blank" class="block p-4 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out">
                         最新活動報名連結
                         </a>
                     <a href="https://www.facebook.com/groups/321305484230739" target="_blank" class="block p-4 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out">
                         社團活動資訊
                     </a>
                     <a href="https://www.facebook.com/groups/4309026639329636" target="_blank" class="block p-4 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out">
                         永續優等生社團
                     </a>
                 </div>
                 <div class="mt-6 text-center">
                     <button id="download-data-button" class="px-8 py-4 bg-blue-700 text-white font-bold rounded-lg shadow hover:bg-blue-800 transition-all duration-300 ease-in-out text-lg">
                         下載永續旅遊數據 (.html) <i class="fas fa-download ml-2"></i>
                     </button>
                 </div>
             </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-500 text-yellow-800 p-5 mb-8 rounded-md" role="alert">
                <p class="font-bold text-yellow-900 mb-2">永續旅遊小貼士 Tips</p>
                <p class="mt-2 animate-pulse-subtle text-gray-700">
                    選擇低碳交通工具及低碳減塑旅宿，攜帶環保旅具包含盥洗用具、拖鞋、購物袋、餐具等。
                    進入農場不隨意摘採與踩踏，野外請遵循生態旅遊原則，留意沿途警示牌，不干擾野生動物，不採摘植物，並帶走所有垃圾。
                </p>
            </div>

            <div class="text-center text-sm text-gray-600 mt-10">
                <p class="mb-3 font-semibold">共同開發單位：</p>
                <ul class="list-disc list-inside mx-auto w-fit text-left mt-3 text-gray-700">
                    <li>社團法人南投縣水里鄉商圈創生共好協會</li>
                    <li>社團法人南投縣青年農民永續發展協會</li>
                    <li>水里里山基地#<a href="https://www.facebook.com/Satoyamadining" target="_blank" class="text-green-600 hover:underline">里山餐桌</a>團隊 #水里青農</li>
                </ul>

                <p class="mb-3 mt-6 font-semibold">教學與計畫支持網絡：</p>
                <ul class="list-disc list-inside mx-auto w-fit text-left mt-3 text-gray-700">
                    <li>國立臺灣大學USR#水里營林區</li>
                    <li>農業部食農教育推廣計畫</li>
                    <li>農業部台中區農改場</li>
                    <li>農業部生物多樣性研究所</li>
                    <li>南投縣政府農業處</li>
                    <li>南投縣農會</li>
                    <li>水里鄉農會</li>
                </ul>

                <p class="mt-6 text-gray-700">© 2025 水里永續共好聯盟。版權所有。</p>
                <p class="mt-2 text-gray-700">開發者信箱: <a href="mailto:farmcmd@gmail.com" class="text-blue-600 hover:underline">farmcmd@gmail.com</a></p>
                <p class="mt-2 text-gray-700">V2.2，歡迎至FACEBOOK粉專「<a href="https://www.facebook.com/Satoyamadining" target="_blank" class="text-green-600 hover:underline">里山餐桌</a>」提出建議。</p>
                
                <!-- 網頁瀏覽人次 -->
                <p class="mt-4 text-xs text-gray-500 border-t border-gray-200 pt-4"><i class="far fa-eye mr-1"></i>網頁瀏覽人次: <span id="page-view-count" class="font-bold text-gray-600">統計中...</span></p>
            </div>

        </section>

        <!-- Mission Page -->
        <section id="mission-page" class="page-section bg-white p-6 rounded-lg shadow-lg">
             <h2 class="text-2xl font-semibold mb-6 text-green-800 text-center">您的永續旅遊任務</h2>
             <button id="back-to-home" class="mb-6 px-6 py-3 bg-gray-300 rounded-lg hover:bg-gray-400 transition-all duration-300 ease-in-out"><i class="fas fa-arrow-left mr-2"></i>返回首頁</button>
             <button id="change-transport-button" class="mb-6 ml-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300 ease-in-out"><i class="fas fa-car-side mr-2"></i>更換交通方式</button>
             <div class="mb-8 p-4 bg-green-100 rounded-md shadow-sm border border-green-200">
                 <p class="font-semibold text-gray-700">目前交通方式: <span id="current-transport-display" class="text-green-800 font-bold">未選擇</span></p>
             </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 bg-gray-200 rounded-lg overflow-hidden shadow-md p-6">
                <div class="lg:col-span-2">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-700">地圖探索</h3>
                        <button id="refresh-map-page-button" class="p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-150 ease-in-out" title="刷新頁面">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <!-- 地圖容器，增加載入中遮罩的父層 -->
                    <div id="map-container" class="relative">
                        <div id="map"></div>
                        <!-- 載入中/錯誤遮罩 -->
                        <div id="map-overlay" class="absolute inset-0 bg-gray-100 flex flex-col justify-center items-center z-10 transition-opacity duration-500">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-700 mb-4"></div>
                            <p id="map-status" class="text-gray-600 font-semibold">地圖載入中...</p>
                        </div>
                    </div>
                    
                     <div class="p-4 bg-gray-300 text-center mt-4 rounded-md">
                         <p class="mt-2 text-sm text-gray-700">請從下方景點列表或地圖上選擇起點和終點</p>
                         <p id="selected-points-display" class="mt-2 text-base font-semibold text-green-800">起點: 未選擇 | 終點: 未選擇</p>
                         <button id="calculate-mileage-button" class="mt-5 px-8 py-4 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out text-lg"><i class="fas fa-route mr-2"></i> 計算本次旅程里程與減碳</button>
                         <p id="trip-calculation-status" class="mt-4 text-sm font-semibold text-gray-700"></p>
                     </div>
                </div>

                <div class="lg:col-span-1 flex flex-col gap-6">

                    <div class="bg-gray-50 p-4 rounded-lg shadow-md overflow-y-auto max-h-[70vh]">
                        <h3 class="text-xl font-semibold mb-4 text-gray-700">景點列表</h3>
                        <ul id="poi-list" class="space-y-3">
                            <li class="text-gray-500 text-center">載入景點中...</li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-gray-700">永續行動與活動</h3>
                         <p class="text-sm text-green-800 font-bold mb-4">
                             紀錄您在這趟旅程中做出對環境維護、永續生產、生態保護、人與自然和平共處的生活態度，讓永續精神實踐在您的生活中。
                         </p>

                        <div class="mb-6 pb-4 border-b border-gray-200">
                            <h4 class="text-lg font-medium mb-3 text-gray-600">記錄您的永續行動 (選擇項目並填寫紀錄獲得積分)</h4>
                            <div id="selectable-actions-list" class="mb-4 space-y-2">
                                <p class="text-gray-500 text-center">載入行動項目中...</p>
                            </div>

                            <textarea id="sustainable-action-log" class="w-full p-3 border rounded-md focus:outline-none focus:ring focus:border-green-500 text-sm" rows="4" placeholder="請在此輸入您具體的永續行動記錄..."></textarea>
                            <button id="log-action-button" class="mt-3 px-6 py-3 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out text-sm"><i class="fas fa-check-circle mr-2"></i>記錄行動並獲得積分</button>
                            <p id="action-log-status" class="mt-3 text-sm font-semibold text-gray-600"></p>
                        </div>

                        <div class="mb-6 pb-4 border-b border-gray-200">
                             <h4 class="text-lg font-medium mb-3 text-gray-600">永續山村任務活動 (選擇活動後點擊參加按鈕)</h4>
                             <p class="text-sm text-green-800 font-bold mb-4">
                                 任務活動非定期舉辦，建議您在出發前，透過各景點的粉絲專頁或社團瞭解活動資訊!
                             </p>
                             <ul id="activity-list" class="space-y-2 text-sm text-gray-700 mb-4">
                                 <li class="text-gray-500 text-center">載入活動中...</li>
                             </ul>
                             <button id="participate-activity-button" class="px-6 py-3 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-all duration-300 ease-in-out text-sm"><i class="fas fa-calendar-check mr-2"></i>參加活動 (輸入驗證碼與內容)</button>
                         </div>

                         <div class="bg-green-50 p-4 rounded-lg shadow-inner max-h-[300px] overflow-y-auto border border-green-200">
                             <h4 class="lg font-medium mb-3 text-gray-600">我的行動紀錄</h4>
                             <div id="logged-actions-list" class="space-y-3">
                                 <p class="text-gray-500 text-center">尚無行動紀錄</p>
                             </div>
                         </div>

                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <!-- Modal 結構保持原樣 -->
    <!-- 綠色消費評鑑 Modal -->
    <div id="green-consumption-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl w-full max-w-2xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-6 text-emerald-700 text-center">綠色消費評鑑計算系統</h3>
            
            <div class="mb-4">
                 <div class="flex border-b border-gray-200">
                    <button class="tab-btn w-1/3 py-2 px-4 text-center font-bold text-gray-600 hover:text-emerald-600 focus:outline-none border-b-2 border-transparent hover:border-emerald-600 active-tab" data-tab="tab-green-procure">
                        1. 綠色採購
                    </button>
                    <button class="tab-btn w-1/3 py-2 px-4 text-center font-bold text-gray-600 hover:text-emerald-600 focus:outline-none border-b-2 border-transparent hover:border-emerald-600" data-tab="tab-sroi">
                        2. SROI 評鑑
                    </button>
                    <button class="tab-btn w-1/3 py-2 px-4 text-center font-bold text-gray-600 hover:text-emerald-600 focus:outline-none border-b-2 border-transparent hover:border-emerald-600" data-tab="tab-project">
                        3. 專案採購
                    </button>
                </div>
            </div>

            <!-- 1. 綠色採購 Tab -->
            <div id="tab-green-procure" class="tab-content block">
                <div class="green-calc-section">
                    <h4 class="text-lg font-bold mb-3 text-emerald-800">消費類別選擇</h4>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">標章類型:</label>
                        <select id="green-label-select" class="w-full p-2 border rounded-md">
                            <option value="Organic">有機農產品標章 (Organic)</option>
                            <option value="TAP">產銷履歷農產品標章 (TAP)</option>
                            <option value="CAS">CAS台灣優良農產品標章 (CAS)</option>
                            <option value="QRCode">溯源產品標示 (QR Code)</option>
                            <option value="EcoLabel">對地綠色環境給付生態標章(如:石虎、濕地等)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                         <label class="block text-sm font-medium text-gray-700 mb-1">產品類型:</label>
                         <select id="green-product-type" class="w-full p-2 border rounded-md">
                             <option value="produce">農產品</option>
                             <option value="processed">加工食品</option>
                         </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">數量:</label>
                            <input type="number" id="green-qty" class="w-full p-2 border rounded-md" min="1" value="1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">單價:</label>
                            <input type="number" id="green-price" class="w-full p-2 border rounded-md" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="text-right mb-4">
                        <p class="text-lg font-bold text-gray-800">小計: <span id="green-subtotal" class="text-emerald-600">0</span></p>
                    </div>
                    <button id="log-green-procure-btn" class="w-full px-6 py-3 bg-emerald-600 text-white font-bold rounded-lg shadow hover:bg-emerald-700">登入消費額按鈕</button>
                    <div class="mt-4 p-3 bg-emerald-50 rounded text-center">
                        <p class="text-sm font-bold text-gray-600">本區登錄總額</p>
                        <p id="total-green-procure-display" class="text-2xl font-bold text-emerald-800">$0</p>
                    </div>
                </div>
            </div>

            <!-- 2. SROI Tab -->
            <div id="tab-sroi" class="tab-content hidden">
                 <div class="green-calc-section">
                    <h4 class="text-lg font-bold mb-3 text-emerald-800">SROI 社會投資報酬率社團</h4>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">選擇單位 (含權重):</label>
                        <select id="sroi-unit-select" class="w-full p-2 border rounded-md">
                            <option value="1.95">指令教育農場 (195%)</option>
                            <option value="1.95">阿爾喜 (195%)</option>
                            <option value="1.58">雨社山下 (158%)</option>
                            <option value="1.58">明揚養蜂 (158%)</option>
                            <option value="2.66">湧健酪梨園 (266%)</option>
                            <option value="3.40">水里里山餐桌團隊 (340%)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                         <label class="block text-sm font-medium text-gray-700 mb-1">消費類型:</label>
                         <select id="sroi-type-select" class="w-full p-2 border rounded-md">
                             <option value="produce">農產品</option>
                             <option value="processed">加工食品</option>
                             <option value="tour">遊程</option>
                             <option value="diy">DIY活動</option>
                             <option value="sustainable_act">永續活動</option>
                             <option value="food_edu">食農教育</option>
                             <option value="eco_edu">生態教育</option>
                         </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">數量:</label>
                            <input type="number" id="sroi-qty" class="w-full p-2 border rounded-md" min="1" value="1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">單價:</label>
                            <input type="number" id="sroi-price" class="w-full p-2 border rounded-md" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="text-right mb-4">
                        <p class="text-sm text-gray-500">計算公式: 數量 * (單價 * SROI權重)</p>
                        <p class="text-lg font-bold text-gray-800">SROI 價值小計: <span id="sroi-subtotal" class="text-emerald-600">0</span></p>
                    </div>
                    <button id="log-sroi-btn" class="w-full px-6 py-3 bg-emerald-600 text-white font-bold rounded-lg shadow hover:bg-emerald-700">登入消費額按鈕</button>
                    <div class="mt-4 p-3 bg-emerald-50 rounded text-center">
                        <p class="text-sm font-bold text-gray-600">本區登錄總額</p>
                        <p id="total-sroi-display" class="text-2xl font-bold text-emerald-800">$0</p>
                    </div>
                </div>
            </div>

            <!-- 3. 專案採購 Tab -->
            <div id="tab-project" class="tab-content hidden">
                 <div class="green-calc-section">
                    <h4 class="text-lg font-bold mb-3 text-emerald-800">專案採購登錄</h4>
                    
                    <div id="project-password-section" class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">請輸入專案密碼:</label>
                        <div class="flex gap-2">
                             <input type="password" id="project-password" class="w-full p-2 border rounded-md" placeholder="請輸入密碼">
                             <button id="unlock-project-btn" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">解鎖</button>
                        </div>
                        <p id="password-msg" class="text-xs text-red-500 mt-1"></p>
                    </div>

                    <div id="project-entry-section" class="hidden">
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">專案說明:</label>
                            <input type="text" id="project-desc" class="w-full p-2 border rounded-md" placeholder="例如: 企業團體採購">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">消費金額:</label>
                            <input type="number" id="project-amount" class="w-full p-2 border rounded-md" min="0" placeholder="0">
                        </div>
                        <button id="log-project-btn" class="w-full px-6 py-3 bg-emerald-600 text-white font-bold rounded-lg shadow hover:bg-emerald-700">登入專案消費金額</button>
                    </div>
                    
                    <div class="mt-4 p-3 bg-emerald-50 rounded text-center">
                        <p class="text-sm font-bold text-gray-600">本區登錄總額</p>
                        <p id="total-project-display" class="text-2xl font-bold text-emerald-800">$0</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- POI Modal -->
    <div id="poi-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 id="poi-modal-title" class="text-2xl font-bold mb-4 text-green-800">景點標題</h3>
            <img id="poi-modal-image" src="" alt="景點圖片" class="mb-4 hidden w-full h-48 object-cover rounded-md">
            <div class="poi-modal-content-body">
                 <p id="poi-modal-description" class="text-gray-700 leading-relaxed"></p>
                 <p id="poi-modal-coordinates" class="text-sm text-gray-600 mt-4"></p>
                 <div id="poi-modal-social" class="mt-4 text-sm">
                 </div>
                 <div id="poi12-buttons" class="mt-6 hidden flex flex-col space-y-3">
                      <a href="https://farmcbd.my.canva.site/dagl50o3mt8" target="_blank" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow hover:bg-blue-700 transition-all duration-300 ease-in-out text-center"><i class="fas fa-gamepad mr-2"></i>水里四季梅遊小遊戲</a>
                      <button id="sroi-order-button-poi12" class="px-6 py-3 bg-purple-600 text-white font-bold rounded-lg shadow hover:bg-purple-700 transition-all duration-300 ease-in-out text-center"><i class="fas fa-leaf mr-2"></i>SROI生態棲地農產品訂購&ESG企業採購表單</button>
                 </div>
                 <div id="sroi-info-button-container" class="mt-6 hidden">
                     <button id="show-sroi-info-button" class="w-full px-6 py-3 bg-purple-600 text-white font-bold rounded-lg shadow hover:bg-purple-700 transition-all duration-300 ease-in-out text-center"><i class="fas fa-leaf mr-2"></i>SROI生態棲地農產品訂購&ESG企業採購表單</button>
                 </div>
                 <div id="poi-modal-dynamic-buttons" class="mt-6 space-y-3"></div>
            </div>

            <div id="poi-review-section" class="hidden mt-6 pt-4 border-t border-gray-200">
                 <h4 class="text-lg font-medium mb-3 text-gray-600">永續消費審核 (消費並輸入審核碼獲得積分)</h4>
                 <div class="mb-3">
                     <label for="consumption-amount" class="block text-sm font-medium text-gray-700 mb-1">消費金額:</label>
                     <input type="number" id="consumption-amount" class="w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-green-500 text-sm" step="1" min="0" placeholder="請輸入消費金額">
                 </div>
                 <div class="mb-4">
                     <label for="review-code" class="block text-sm font-medium text-gray-700 mb-1">審核碼 (3碼數字):</label>
                     <input type="text" id="review-code" class="w-full p-2 border rounded-md focus:outline-none focus:ring focus:border-green-500 text-sm" maxlength="3" placeholder="請輸入3碼數字審核碼">
                 </div>
                 <button id="submit-poi-review" class="px-6 py-3 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out text-sm"><i class="fas fa-check-circle mr-2"></i>提交審核並獲得積分</button>
                 <p id="poi-review-status" class="mt-3 text-sm font-semibold text-gray-600"></p>
            </div>

             <div class="mt-6 flex justify-end space-x-4">
                 <button id="set-as-start-button" class="px-6 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-all duration-300 ease-in-out"><i class="fas fa-map-marker-alt mr-2"></i>設定為起點</button>
                 <button id="set-as-end-button" class="px-6 py-3 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-all duration-300 ease-in-out"><i class="fas fa-flag-checkered mr-2"></i>設定為終點</button>
             </div>
        </div>
    </div>

    <!-- Activity Modal -->
    <div id="activity-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-4 text-green-800">參加活動：<span id="selected-activity-name"></span></h3>
            <img id="activity-modal-image" src="" alt="活動相關圖片" class="mb-4 hidden">
            <p class="mb-2 text-gray-700">請輸入活動驗證碼</p>
            <input type="text" id="verification-code-input" class="w-full p-3 border rounded-md mb-4 focus:outline-none focus:ring focus:border-green-500">
            <p class="mb-2 text-gray-700">請輸入活動內容或課程名稱</p>
            <textarea id="activity-content-input" class="w-full p-3 border rounded-md mb-4 focus:outline-none focus:ring focus:border-green-500" rows="3" placeholder="例如：參加了里山倡議食農下午茶講堂，學習製作香草餅乾"></textarea>
            <button id="submit-activity-log" class="px-6 py-3 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-all duration-300 ease-in-out text-sm"><i class="fas fa-check-square mr-2"></i>記錄活動並獲得積分</button>
            <p id="activity-log-status" class="mt-4 text-sm font-semibold text-gray-700"></p>
        </div>
    </div>

    <!-- THSR Modal -->
    <div id="thsr-info-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-4 text-blue-800">高鐵假期x台灣好行 交通資訊</h3>
            <div class="text-gray-700 leading-relaxed">
                <p class="mb-3">您已抵達水里小鎮，感謝您使用高鐵假期做為您的減碳旅遊方式，以下是我們提供給您的交通與住宿資訊:</p>
                <p class="mb-3">台灣高鐵X台鐵台中干城站 > 台灣好行6333D集集線 > 到水里</p>
                <p class="mb-4">
                    水里台灣好行到 >
                    <a href="https://www.taiwantrip.com.tw/Frontend/Route/Select_p?RouteID=R0096" target="_blank" class="text-blue-600 hover:underline font-semibold">6288雙龍線</a> >
                    <a href="https://www.taiwantrip.com.tw/Frontend/Route/Select_p?RouteID=R0061" target="_blank" class="text-blue-600 hover:underline font-semibold">6671車程線</a> >
                    <a href="https://www.taiwantrip.com.tw/Frontend/Route/Select_p?RouteID=R0068" target="_blank" class="text-blue-600 hover:underline font-semibold">6734、6732東埔線</a>。
                 </p>
                <p class="mb-4">住宿建議請參考景點 > 環保旅宿推薦。</p>
            </div>
        </div>
    </div>

    <!-- Log Trip Modal -->
    <div id="log-trip-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-4 text-orange-700">記錄前往景點的旅程</h3>
            <p class="mb-4 text-gray-700">您正在記錄前往：<span id="log-trip-poi-name" class="font-semibold text-green-800"></span></p>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">選擇交通方式:</label>
                <div id="log-trip-transport-options" class="flex flex-wrap gap-3">
                </div>
                 <p id="log-trip-transport-status" class="mt-3 text-sm font-semibold text-red-600 hidden">請選擇交通方式。</p>
             </div>

            <div class="mb-6">
                <label for="log-trip-mileage" class="block text-sm font-medium text-gray-700 mb-3">輸入抵達里程數 (公里):</label>
                <input type="number" id="log-trip-mileage" class="w-full p-3 border rounded-md focus:outline-none focus:ring focus:border-green-500" step="0.1" min="0" placeholder="例如: 5.2">
                <p id="log-trip-mileage-status" class="mt-3 text-sm font-semibold text-red-600 hidden">請輸入有效的里程數。</p>
            </div>

            <div class="mt-6 flex justify-end">
                <button id="submit-log-trip" class="px-8 py-4 bg-orange-600 text-white font-bold rounded-lg shadow hover:bg-orange-700 transition-all duration-300 ease-in-out text-lg"><i class="fas fa-road mr-2"></i>記錄旅程並計算減碳/分數</button>
            </div>
             <p id="log-trip-status" class="mt-4 text-sm font-semibold text-gray-700"></p>
         </div>
    </div>

    <!-- Taxi Info Modal -->
    <div id="taxi-info-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-4 text-yellow-700">多元計程車導覽旅遊資訊</h3>
            <div class="text-gray-700 leading-relaxed">
                <p class="mb-2"><strong>車號:</strong> TBD-5339</p>
                <p class="mb-2"><strong>駕駛人:</strong> 詹聖慈</p>
                <p class="mb-2"><strong>營業時間:</strong> 9:00~20:00</p>
                <p class="mb-2"><strong>旅遊範圍:</strong> 水里鄉、信義鄉、日月潭</p>
                <p class="mb-2"><strong>最大乘客數:</strong> 4</p>
                <p class="mb-2"><strong>駕駛人永續旅遊導覽培訓時數:</strong> 12/時</p>
                <p class="mb-2"><strong>預約叫車電話:</strong> 0980-015-339</p>
                <p class="mb-2"><strong>LINE ID:</strong> 未提供</p>
            </div>
             <p class="mt-6 text-sm text-gray-600">若有需求請於出發一周前直接聯繫駕駛人預約及確認詳細資訊。</p>
        </div>
    </div>

    <!-- Photo Album Modal -->
    <div id="photo-album-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl w-full max-w-md">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-6 text-teal-700 text-center">景點相簿推播</h3>
            <div class="space-y-4">
                <div>
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">精選旅程</h4>
                    <ul class="list-disc list-inside pl-4 space-y-1">
                        <li><a href="#" class="text-blue-600 hover:underline photo-album-link" data-album-id="xiaonong">小農遊程</a></li>
                        <li><a href="#" class="text-blue-600 hover:underline photo-album-link" data-album-id="shengtai">生態旅遊</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">好事市集</h4>
                    <ul class="list-disc list-inside pl-4 space-y-1">
                        <li><a href="https://photos.google.com/share/AF1QipN86zQIAJaA-HyNbExPBNARmU7VT1eEOS2JNsjAC1VfonWpOT5zDAwIVwbueSdfWQ?key=NlN1NlVVS0tZdWhiRV9HYnlsSnNsV0VXVHN5YVJR" target="_blank" class="text-blue-600 hover:underline">星光市集</a></li>
                        </ul>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-6 text-center">部分相簿連結建設中，敬請期待！</p>
        </div>
    </div>

    <!-- 企業版 Modal -->
    <div id="enterprise-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-4 text-yellow-700 text-center">企業永續旅遊專區</h3>
            <div class="text-gray-700 leading-relaxed space-y-4">
                <div class="text-center text-5xl mb-4">🏢</div>
                <p class="text-center font-bold text-gray-800">歡迎企業夥伴員工登入</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                     <a href="#" class="block p-4 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-yellow-800">◯◯◯企業/集團</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                     <a href="#" class="block p-4 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-yellow-800">◯◯◯企業/集團</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                     <a href="#" class="block p-4 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-yellow-800">◯◯◯企業/集團</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                     <a href="#" class="block p-4 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-yellow-800">◯◯◯企業/集團</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                     <a href="#" class="block p-4 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-yellow-800">◯◯◯企業/集團</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                     <a href="#" class="block p-4 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-yellow-800">◯◯◯企業/集團</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                </div>
            </div>
        </div>
    </div>

    <!-- 永續政府 Modal -->
    <div id="gov-modal" class="modal-overlay hidden">
        <div class="modal-content shadow-xl">
            <span class="close-button">×</span>
            <h3 class="text-2xl font-bold mb-4 text-blue-700 text-center">永續政府管理平台</h3>
            <div class="text-gray-700 leading-relaxed space-y-4">
                <div class="text-center text-5xl mb-4">🏛️</div>
                <p class="text-center font-bold text-gray-800">歡迎公務機關同仁登入</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <a href="https://docs.google.com/document/d/1v2TkJWN0WbwG3uOjUEaZCwci5UfKnkQSaiE9JEc-Hoo/edit?tab=t.0" target="_blank" class="block p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-center transition duration-300 group">
                        <span class="font-bold text-blue-800 group-hover:text-blue-900 block">南投縣政府農業處林保科</span>
                        <span class="block text-xs text-gray-600 mt-1 font-semibold">一次型計畫活動</span>
                        <span class="block text-xs text-blue-500 mt-1 hover:underline">SROI 社會價值報告書</span>
                    </a>
                    <a href="#" class="block p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-blue-800">◯◯◯機關/機構</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                    <a href="#" class="block p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-blue-800">◯◯◯機關/機構</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                    <a href="#" class="block p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-blue-800">◯◯◯機關/機構</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                    <a href="#" class="block p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-blue-800">◯◯◯機關/機構</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                    <a href="#" class="block p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-center transition duration-300 group"><span class="font-bold text-blue-800">◯◯◯機關/機構</span><span class="block text-xs text-gray-500 mt-1">(連結建置中)</span></a>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
